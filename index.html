<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="zh-CN"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="referrer" content="no-referrer"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;汽水音乐解析 - Pro版&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body { font-family: sans-serif; background: #121212; color: #fff; text-align: center; padding: 20px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.box { max-width: 400px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #2c2c2c; color: #fff; box-sizing: border-box; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #00ebff; color: #000; font-weight: bold; cursor: pointer; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#result { margin-top: 20px; display: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>img { width: 100%; border-radius: 10px; margin-bottom: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>audio { width: 100%; margin-top: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.loading { color: #00ebff; display: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;div class="box"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;h2&gt;汽水解析下载&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="urlInput" placeholder="在此粘贴汽水音乐分享链接"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;button onclick="doParse()"&gt;开始解析&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="loading" class="loading"&gt;正在穿透解析中...&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="result"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;img id="cover" src="" alt="cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;h3 id="title"&gt;&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p id="artist"&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;audio id="player" controls&gt;&lt;/audio&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button style="background: #34c759; margin-top: 10px;" onclick="doDownload()"&gt;下载到本地&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentMusic = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function doParse() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const input = document.getElementById('urlInput').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const match = input.match(/https?:\/\/qishui\.douyin\.com\/s\/[a-zA-Z0-9]+\/?/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(!match) return alert("链接格式不对！");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('loading').style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('result').style.display = 'none';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// 尝试多个不同的 CORS 代理，防止 403</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const proxies = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`https://api.allorigins.win/raw?url=${encodeURIComponent(match[0])}`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`https://corsproxy.io/?${encodeURIComponent(match[0])}`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let html = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let p of proxies) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const res = await fetch(p);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(res.ok) { html = await res.text(); break; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} catch (e) {}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('loading').style.display = 'none';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(!html) return alert("解析失败：代理服务器均不可用");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 解析逻辑增强：适配 2026 最新数据结构</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const matchData = html.match(/_ROUTER_DATA\s*=\s*({[\s\S]*?});/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const json = JSON.parse(matchData[1]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const track = json?.loaderData?.track_page?.audioWithLyricsOption ||<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>json?.loaderData?.['track_page/index']?.audioWithLyricsOption;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if(!track) throw new Error("数据提取路径错误");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentMusic = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>title: track.trackName,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>artist: track.artistName,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>cover: track.coverURL,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>url: track.url</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('title').innerText = currentMusic.title;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('artist').innerText = currentMusic.artist;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('cover').src = currentMusic.cover;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('player').src = currentMusic.url;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('result').style.display = 'block';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert("解析错误：" + e.message);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function doDownload() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(!currentMusic) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const res = await fetch(currentMusic.url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const blob = await res.blob();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const a = document.createElement('a');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>a.href = URL.createObjectURL(blob);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>a.download = `${currentMusic.title}-${currentMusic.artist}.mp3`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>a.click();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>window.open(currentMusic.url); // 备选：直接打开链接</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
